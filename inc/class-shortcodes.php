<?php

/**
 * Footer emissions functionality.
 *
 * This file handles the display of carbon emissions through shortcodes.
 *
 * @package CarbonFooter
 */

namespace CarbonfooterPlugin;

// Exit if accessed directly
if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Shortcodes
 *
 * Handles emissions widget rendering via shortcodes and optional automatic
 * insertion into the footer. Provides three styles: minimal, sticker, full.
 *
 * Responsibilities:
 * - Render UI fragments with proper escaping and limited inline styles
 * - Fetch emissions for the current page or fall back to average
 * - Support localized messages and accessible markup
 */
class Shortcodes {



	/**
	 * Emissions instance.
	 *
	 * @var Emissions
	 */
	private $emissions;

	/**
	 * Constructor.
	 */
	public function __construct() {
		// Initialize dependencies
		$this->emissions = new Emissions();

		// Add main shortcode (uses style from settings)
		add_shortcode( 'carbonfooter', array( $this, 'render_carbonfooter' ) );

		// Allow SVG in WordPress
		add_filter( 'wp_kses_allowed_html', array( $this, 'allow_svg_in_kses' ), 10, 2 );

		// Add footer hook if enabled in settings
		add_action( 'wp_footer', array( $this, 'maybe_add_to_footer' ), 50 );
	}

	/**
	 * Allow SVG elements in wp_kses.
	 *
	 * Extends the allowed tags for the 'post' context to support inline icons
	 * within the widget markup.
	 *
	 * @param array  $allowed_html Allowed tags
	 * @param string $context      Kses context
	 * @return array Modified allowed tags
	 */
	public function allow_svg_in_kses( $allowed_html, $context ) {
		if ( $context === 'post' ) {
			$allowed_html['svg']  = array(
				'class'   => array(),
				'fill'    => array(),
				'xmlns'   => array(),
				'viewbox' => array(),
				'width'   => array(),
				'height'  => array(),
			);
			$allowed_html['path'] = array(
				'd' => array(),
			);
		}
		return $allowed_html;
	}

	/**
	 * Get common CSS variables.
	 *
	 * Returns a string to be used in a `style` attr to pass CSS custom props
	 * (background/text colors) to the inline widget styles.
	 *
	 * @return string CSS variables string
	 */
	private function get_common_css_vars() {
		return '
      --cf-container-width: 1200px;
      --cf-color-background: ' . esc_attr( get_option( 'carbonfooter_widget_background_color', '#000000' ) ) . ';
      --cf-color-foreground: ' . esc_attr( get_option( 'carbonfooter_widget_text_color', '#FFFFFF' ) ) . ';
    ';
	}

	/**
	 * Enqueue widget styles for a specific style type.
	 *
	 * Registers and enqueues styles for the widget shortcode using wp_add_inline_style().
	 *
	 * @param string $style_type The style type (minimal, sticker, full)
	 * @return void
	 */
	private function enqueue_widget_styles( string $style_type ): void {
		$handle = 'carbonfooter-widget-' . $style_type;

		// Register style handle with empty source (inline-only styles)
		wp_register_style( $handle, '', array(), CARBONFOOTER_VERSION );
		wp_enqueue_style( $handle );

		// Get the appropriate styles based on type
		$styles = '';
		switch ( $style_type ) {
			case 'minimal':
				$styles = $this->get_minimal_styles_content();
				break;
			case 'sticker':
				$styles = $this->get_sticker_styles_content();
				break;
			case 'full':
				$styles = $this->get_full_styles_content();
				break;
		}

		// Add inline styles
		wp_add_inline_style( $handle, $styles );
	}

	/**
	 * Get minimal widget styles content (without style tags).
	 *
	 * @return string CSS content
	 */
	private function get_minimal_styles_content() {
		return '
      .cf-minimal {
        background-color: var(--cf-color-background);
        color: var(--cf-color-foreground);
        padding: 8px 0 16px;
        font-size: 14px;
      }
      .cf-minimal__content {
        display: flex;
        justify-content: center;
        text-align: center;
        width: 90%;
        max-width: 900px;
        margin: 0 auto;
      }
      .cf-minimal__text {
        font-size: 14px;
      }
      .cf-minimal__text a {
        color: var(--cf-color-foreground);
      }
      .cf-minimal__value {
        font-weight: bold;
      }
      .cf-minimal__link {
        display: inline-flex;
        align-items: baseline;
        gap: 4px;
      }
      .cf-minimal__link:hover {
        text-decoration: underline;
      }
      .cf-minimal__link-icon {
        --icon-size: 24px;
        width: var(--icon-size);
        height: var(--icon-size);
      }
    ';
	}

	/**
	 * Get sticker widget styles content (without style tags).
	 *
	 * @return string CSS content
	 */
	private function get_sticker_styles_content() {
		return '
      .cf-sticker {
        aspect-ratio: 1/1;
        width: 100%;
        max-width: 300px;
        color: var(--cf-color-foreground);
        display: grid;
        place-items: center;
        justify-content: center;
        font-size: 16px;
        position: relative;
        line-height: 1.2;
        margin-left: auto;
      }
      .cf-sticker__cloud {
        --icon-size: 100%;
        width: var(--icon-size);
        height: var(--icon-size);
        position: absolute;
        top: 0;
        left: 0;
      }
      .cf-sticker__text {
        text-wrap: balance;
        position: relative;
        z-index: 1;
        text-align: center;
        padding: 80px;
        margin-left: 20px;
        line-height: 1.2;
      }
      .cf-sticker__value {
        font-weight: bold;
      }
    ';
	}

	/**
	 * Get full widget styles content (without style tags).
	 *
	 * @return string CSS content
	 */
	private function get_full_styles_content() {
		return '
      .cf-full {
        background-color: var(--cf-color-background);
        color: var(--cf-color-foreground);
        padding: 24px 0 32px;
        font-size: 16px;
        text-align: center;
      }
      .cf-full__row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
        justify-content: center;
        align-items: center;
        height: 100%;
        max-width: var(--cf-container-width);
        margin: 0 auto;
        width: 90%;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--cf-color-foreground);
      }
      @media(min-width: 1024px) {
        .cf-full__row {
          grid-template-columns: repeat(4, 1fr);
        }
      }
      @media(min-width: 1280px) {
        .cf-full__row {
          grid-template-columns: repeat(5, 1fr);
        }
      }
      .cf-full__col {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 8px;
        border: 1px solid var(--cf-color-foreground);
        height: 100%;
      }
      @media(min-width: 1280px) {
        .cf-full__col {
          padding: 0;
          border: none;
        }
      }
      .cf-full__col.trees-offset {
        display: none;
      }
      @media (min-width: 1280px) {
        .cf-full__col.trees-offset {
          display: flex;
        }
      }
      .cf-full__title {
        font-weight: bold;
        color: var(--cf-color-foreground);
        margin: 0;
        line-height: 1;
      }
      .cf-full__text {
        margin: 0;
        line-height: 1;
      }
      .cf-full__cta {
        display: flex;
        justify-content: center;
        line-height: 1;
        gap: 8px;
        margin-top: 32px;
      }
      .cf-full__cta-link-text {
        display: flex;
        gap: 4px;
        margin-top: 4px;
        justify-content: center;
      }
      @media(min-width: 600px) {
        .cf-full__cta-link-text {
          display: inline-flex;
          justify-content: start;
          margin-top: 0;
          align-items: baseline;
          gap: 4px;
        }
      }
      .cf-full__cta-icon {
        height: 20px;
      }
      .cf-full__icon {
        display: block;
        margin-bottom: 12px;
        width: auto;
        height: 40px;
        color: var(--cf-color-foreground);
      }
      @media(min-width: 768px) {
        .cf-full__icon {
          height: 80px;
        }
      }
    ';
	}

	/**
	 * Conditionally add emissions widget to the footer.
	 *
	 * Only injects on the frontend when `carbonfooter_display_setting` is set to
	 * `auto`. Respects admin/AJAX contexts.
	 *
	 * @return void
	 */
	public function maybe_add_to_footer() {
		// Don't show in admin or during AJAX requests
		if ( \is_admin() || \wp_doing_ajax() ) {
			return;
		}

		// Get display setting - check if auto display is enabled
		$display_setting = get_option( 'carbonfooter_display_setting', 'shortcode' );

		// If not set to auto, don't show anything
		if ( $display_setting !== 'auto' ) {
			return;
		}

		// Wrap in a div with clear styling to avoid theme conflicts
		echo '<div id="carbonfooter" class="carbonfooter">';
		echo do_shortcode( '[carbonfooter]' );
		echo '</div>';
	}

	/**
	 * Render the carbonfooter shortcode based on widget style setting.
	 *
	 * Reads `carbonfooter_widget_style` and dispatches to the corresponding
	 * renderer. Defaults to minimal.
	 *
	 * @return string The shortcode output.
	 */
	public function render_carbonfooter() {
		// Get the widget style from settings
		$widget_style = get_option( 'carbonfooter_widget_style', 'minimal' );

		// Render the appropriate style
		switch ( $widget_style ) {
			case 'sticker':
				return $this->render_sticker();
			case 'full':
				return $this->render_full();
			case 'minimal':
			default:
				return $this->render_minimal();
		}
	}

	/**
	 * Render minimal emissions display.
	 *
	 * @return string The shortcode output.
	 */
	public function render_minimal() {
		// Enqueue styles for this widget type
		$this->enqueue_widget_styles( 'minimal' );

		$emissions = $this->get_current_page_emissions();
		$link      = 'https://carbonfooter.nl/';
		$icon      = '<svg class="cf-minimal__link-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 995 768">
    <path d="M102.26,600.22s-31.43-47.8-67.16-27.24c-41.94,24.74-15.18,73.97-15.18,73.97,0,0-38.96,43.14,5.38,69.43,49.47,29.52,67.88-24.74,67.88-24.74h0s65.6,4.55,66.68-49.35c.84-47.8-57.6-42.07-57.6-42.07Z" />
    <path d="M841.11,279.51c20.9-26.96,31.38-60.17,29.63-93.85-1.75-33.68-15.63-65.7-39.22-90.49C748.06-.49,627.65,55.4,627.65,55.4h0c-17.13-19.23-39.17-33.76-63.9-42.15-24.74-8.39-51.31-10.35-77.08-5.68-27.11,3.63-52.79,13.96-74.6,30-21.8,16.03-38.98,37.23-49.89,61.56,0,0-71.19-67.65-165.66,27.33-94.46,94.98-17.76,176.42-17.76,176.42,0,0-116.31,47.7-72.46,165.76,12.02,33.28,34.39,62.13,64.04,82.56,29.64,20.44,65.1,31.46,101.48,31.54,0,0-5.5,157.7,121.81,177.65,34.61,6.59,70.49,2.17,102.29-12.6,31.81-14.78,57.84-39.11,74.22-69.39,0,0,56.39,122.99,188.77,48.79,132.38-74.2,83.46-143.9,83.46-143.9,0,0,134.07-14.62,145.07-134.06,10.99-119.43-146.32-169.72-146.34-169.73Z" />
  </svg>';

		ob_start();
		$css_vars = $this->get_common_css_vars();
		?>
		<div id="carbonfooter" style="<?php echo esc_attr( $css_vars ); ?>">
			<div class="cf-minimal">
				<div class="cf-minimal__content">
					<p class="cf-minimal__text">
						<?php
						$emissions_value = '<span class="cf-minimal__value">' . esc_html( $emissions['emissions'] ) . ' g CO<sub>2</sub></span>';
						$link_html       = sprintf(
							'<a class="cf-minimal__link" href="%s" target="_blank" rel="noopener noreferrer"><span>%s</span>%s</a>',
							esc_url( $link ),
							esc_html__( 'Carbonfooter.nl', 'carbonfooter' ),
							wp_kses_post( $icon )
						);

						echo wp_kses_post(
							sprintf(
								/* translators: %1$s is the CO2 emissions HTML span, %2$s is the link HTML */
								esc_html__( 'This page produced %1$s per page view. Want to learn more? %2$s', 'carbonfooter' ),
								$emissions_value,
								$link_html
							)
						);
						?>
					</p>
				</div>
			</div>
		</div>
		<?php
		return ob_get_clean();
	}

	/**
	 * Render sticker emissions display.
	 *
	 * @return string The shortcode output.
	 */
	public function render_sticker() {
		// Enqueue styles for this widget type
		$this->enqueue_widget_styles( 'sticker' );

		$emissions = $this->get_current_page_emissions();
		$link      = 'https://carbonfooter.nl/';
		$icon      = '<svg class="cf-sticker__cloud" xmlns="http://www.w3.org/2000/svg" fill="var(--cf-color-background)" viewBox="0 0 995 768"><path d="M841.11,279.51c20.9-26.96,31.38-60.17,29.63-93.85-1.75-33.68-15.63-65.7-39.22-90.49C748.06-.49,627.65,55.4,627.65,55.4h0c-17.13-19.23-39.17-33.76-63.9-42.15-24.74-8.39-51.31-10.35-77.08-5.68-27.11,3.63-52.79,13.96-74.6,30-21.8,16.03-38.98,37.23-49.89,61.56,0,0-71.19-67.65-165.66,27.33-94.46,94.98-17.76,176.42-17.76,176.42,0,0-116.31,47.7-72.46,165.76,12.02,33.28,34.39,62.13,64.04,82.56,29.64,20.44,65.1,31.46,101.48,31.54,0,0-5.5,157.7,121.81,177.65,34.61,6.59,70.49,2.17,102.29-12.6,31.81-14.78,57.84-39.11,74.22-69.39,0,0,56.39,122.99,188.77,48.79,132.38-74.2,83.46-143.9,83.46-143.9,0,0,134.07-14.62,145.07-134.06,10.99-119.43-146.32-169.72-146.34-169.73Z"/><path class="cls-1" d="M102.26,600.22s-31.43-47.8-67.16-27.24c-41.94,24.74-15.18,73.97-15.18,73.97,0,0-38.96,43.14,5.38,69.43,49.47,29.52,67.88-24.74,67.88-24.74h0s65.6,4.55,66.68-49.35c.84-47.8-57.6-42.07-57.6-42.07Z"/><path class="cls-1" d="M841.11,279.51c20.9-26.96,31.38-60.17,29.63-93.85-1.75-33.68-15.63-65.7-39.22-90.49C748.06-.49,627.65,55.4,627.65,55.4h0c-17.13-19.23-39.17-33.76-63.9-42.15-24.74-8.39-51.31-10.35-77.08-5.68-27.11,3.63-52.79,13.96-74.6,30-21.8,16.03-38.98,37.23-49.89,61.56,0,0-71.19-67.65-165.66,27.33-94.46,94.98-17.76,176.42-17.76,176.42,0,0-116.31,47.7-72.46,165.76,12.02,33.28,34.39,62.13,64.04,82.56,29.64,20.44,65.1,31.46,101.48,31.54,0,0-5.5,157.7,121.81,177.65,34.61,6.59,70.49,2.17,102.29-12.6,31.81-14.78,57.84-39.11,74.22-69.39,0,0,56.39,122.99,188.77,48.79,132.38-74.2,83.46-143.9,83.46-143.9,0,0,134.07-14.62,145.07-134.06,10.99-119.43-146.32-169.72-146.34-169.73Z"/></svg>';

		ob_start();
		$css_vars = $this->get_common_css_vars();
		?>
		<div id="carbonfooter" style="<?php echo esc_attr( $css_vars ); ?>">
			<div class="cf-sticker">
				<?php echo wp_kses_post( $icon ); ?>
				<p class="cf-sticker__text">
					<?php
					$emissions_value = '<span class="cf-sticker__value">' . esc_html( $emissions['emissions'] ) . ' g CO<sub>2</sub></span>';
					$link_html       = sprintf(
						'<a class="cf-sticker__link" href="%s" target="_blank" rel="noopener noreferrer"><span>%s</span></a>',
						esc_url( $link ),
						esc_html__( 'Carbonfooter.nl', 'carbonfooter' )
					);

					echo wp_kses_post(
						sprintf(
							/* translators: %1$s is the CO2 emissions HTML span, %2$s is the link HTML */
							esc_html__( 'This page produced %1$s per page view.', 'carbonfooter' ),
							$emissions_value,
							$link_html
						)
					);
					?>
				</p>
			</div>
		</div>
		<?php
		return ob_get_clean();
	}

	/**
	 * Render full emissions display.
	 *
	 * @return string The shortcode output.
	 */
	public function render_full() {
		// Enqueue styles for this widget type
		$this->enqueue_widget_styles( 'full' );

		$emissions = $this->get_current_page_emissions();
		$average   = get_option( 'carbonfooter_average_emissions', 0 );
		$link      = 'https://carbonfooter.nl/';

		$emissions_value     = esc_html( $emissions['emissions'] );
		$page_size_value     = esc_html( $emissions['page_size'] );
		$formatted_page_size = $page_size_value . ' bytes';

		if ( $page_size_value >= 1024 && $page_size_value < 1024 * 1024 ) {
			$formatted_page_size = round( $page_size_value / 1024, 0 ) . ' KB';
		}

		if ( $page_size_value >= 1024 * 1024 && $page_size_value < 1024 * 1024 * 1024 ) {
			$formatted_page_size = round( $page_size_value / ( 1024 * 1024 ), 2 ) . ' MB';
		}

		// Get green host status
		$is_green_host = (bool) get_option( 'carbonfooter_greenhost', false );
		// $icon = $this->get_cta_icon();
		$icon = '<svg class="cf-full__cta-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 995 768">
    <path d="M102.26,600.22s-31.43-47.8-67.16-27.24c-41.94,24.74-15.18,73.97-15.18,73.97,0,0-38.96,43.14,5.38,69.43,49.47,29.52,67.88-24.74,67.88-24.74h0s65.6,4.55,66.68-49.35c.84-47.8-57.6-42.07-57.6-42.07Z" />
    <path d="M841.11,279.51c20.9-26.96,31.38-60.17,29.63-93.85-1.75-33.68-15.63-65.7-39.22-90.49C748.06-.49,627.65,55.4,627.65,55.4h0c-17.13-19.23-39.17-33.76-63.9-42.15-24.74-8.39-51.31-10.35-77.08-5.68-27.11,3.63-52.79,13.96-74.6,30-21.8,16.03-38.98,37.23-49.89,61.56,0,0-71.19-67.65-165.66,27.33-94.46,94.98-17.76,176.42-17.76,176.42,0,0-116.31,47.7-72.46,165.76,12.02,33.28,34.39,62.13,64.04,82.56,29.64,20.44,65.1,31.46,101.48,31.54,0,0-5.5,157.7,121.81,177.65,34.61,6.59,70.49,2.17,102.29-12.6,31.81-14.78,57.84-39.11,74.22-69.39,0,0,56.39,122.99,188.77,48.79,132.38-74.2,83.46-143.9,83.46-143.9,0,0,134.07-14.62,145.07-134.06,10.99-119.43-146.32-169.72-146.34-169.73Z" />
  </svg>';

		ob_start();
		?>

		<div id="carbonfooter" class="cf-full">
			<div class="cf-full__row">
				<div class="cf-full__col green-host">
					<svg class="cf-full__icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156.76 154.49">
						<path d="M131.95,72.38l-10.37,4.56.37.86,10.37-4.56-.37-.86ZM121.78,49.24l-10.38,4.58.37.86,10.39-4.58-.37-.86ZM58.23,83.87l.05.11c10.35-4.66,15.68-13.54,18.98-19.03,1.62-2.75,2.82-4.75,4.2-5.35l15.88-6.97c.72-.33,1.57,0,1.88.72l1.4,3.15,9.06-3.97.37.86,10.79-4.76c1.08-.47,2.35,0,2.81,1.09.47,1.08,0,2.35-1.09,2.81l-10.8,4.76.37.86-9.06,3.97,7.68,17.52,9.1-3.98.37.86,10.79-4.76c1.08-.47,2.34.03,2.8,1.11.48,1.06,0,2.32-1.09,2.81l-10.79,4.73.37.86-9.07,3.99,1.26,2.88c.32.75,0,1.57-.73,1.9l-15.88,6.97c-1.39.62-3.71.16-6.91-.49-6.26-1.29-16.3-3.31-26.7,1.15l.6,1.35-9.29,4.09-2.4-5.47c-9.84,3.69-14.58,8.85-18.15,12.75-6.45,7.04-9.95,10.87-24.61,1.8-1.33-.84-1.78-2.59-.93-3.95.81-1.35,2.58-1.75,3.93-.94,10.64,6.58,13.02,4.01,17.36-.75,3.98-4.32,9.2-10.06,20.06-14.14l-2.53-5.77,9.29-4.09.59,1.32Z" />
						<path d="M109.56,19.5c.2.41.22.9.06,1.33l-5.63,15.47h0c-.33.9-1.33,1.37-2.24,1.04-.9-.33-1.37-1.33-1.04-2.24l5.63-15.47h0c.24-.67.86-1.11,1.56-1.15.7-.03,1.36.37,1.66,1.01Z" />
						<path d="M71.56,21.87l6.96,14.92c.41.87.03,1.91-.84,2.32-.88.41-1.91.03-2.32-.84l-6.96-14.92c-.41-.88-.03-1.91.84-2.32.87-.41,1.91-.03,2.32.84Z" />
						<path d="M62.85,55.04c.3.64.18,1.4-.29,1.91-.48.53-1.22.7-1.89.46l-15.47-5.63c-.91-.33-1.38-1.33-1.04-2.23.33-.91,1.33-1.38,2.23-1.04l15.47,5.63h0c.44.16.79.48.99.9Z" />
						<path d="M79.65,129.04c-.2-.41-.22-.9-.06-1.33l5.63-15.47h0c.33-.9,1.33-1.37,2.24-1.04.9.33,1.37,1.33,1.04,2.24l-5.63,15.47h0c-.24.67-.86,1.11-1.56,1.15-.7.03-1.36-.37-1.66-1.01Z" />
						<path d="M117.65,126.68l-6.96-14.92c-.41-.87-.03-1.91.84-2.32.88-.41,1.91-.03,2.32.84l6.96,14.92c.41.88.03,1.91-.84,2.32-.87.41-1.91.03-2.32-.84Z" />
						<path d="M126.37,93.51c-.3-.64-.18-1.4.29-1.91.48-.53,1.22-.71,1.89-.46l15.46,5.63c.91.33,1.38,1.33,1.04,2.23-.33.91-1.33,1.38-2.23,1.04l-15.47-5.63h0c-.43-.16-.79-.48-.99-.9Z" />
					</svg>

					<p class="cf-full__title">
						<?php echo $is_green_host ? esc_html__( 'Yes!', 'carbonfooter' ) : esc_html__( 'No!', 'carbonfooter' ); ?>
					</p>
					<p class="cf-full__text">
						<?php echo $is_green_host ? esc_html__( 'green energy', 'carbonfooter' ) : esc_html__( 'not green energy', 'carbonfooter' ); ?>
					</p>
				</div>
				<div class="cf-full__col page-size">

					<svg class="cf-full__icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156.76 154.49">
						<path d="M138.56,52.41l-8.38,50.39c-.16.96-1.18,1.24-1.83.86l-65.11-37.59,8.69-52.25c.18-1.11,1.13-1.91,2.25-1.91.4,0,.78.1,1.13.31l60.85,35.13c1.77,1.02,2.73,3.06,2.4,5.07h0ZM129.29,111.03l-41.17,23.77c-2.01,1.16-4.5,1.16-6.51,0l-62.87-36.3c-.31-.18-.53-.47-.6-.82,0-.03-.02-.05-.03-.07v-2.37s.08.07.12.1l26.09,15.06.17.35c.33.69.85,1.26,1.52,1.64l5.64,3.26c.84.49,1.8.77,2.77.81l.44.02,27.22,15.71c.86.5,1.83.75,2.79.75s1.93-.25,2.79-.75l42.1-24.31v2.32c0,.34-.17.64-.47.81h0ZM54.15,115.42c-.7-.08-1.38-.29-1.99-.64l-5.64-3.25c-.4-.23-.71-.57-.95-.97h.28c.47,0,.97.12,1.4.37l5.82,3.36c.46.27.84.66,1.08,1.14h0ZM18.75,92.27l42.83-24.72c.68-.39,1.53-.39,2.2,0t0,0l63.64,36.74h0l1.87,1.08h0c.29.17.47.48.47.81s-.18.64-.47.81l-42.14,24.33c-1.41.81-3.16.81-4.57,0l-27.19-15.7-.35-.67c-.33-.65-.84-1.19-1.48-1.55l-5.82-3.36c-.58-.34-1.26-.54-1.92-.51h-.98s-26.1-15.07-26.1-15.07c-.4-.23-.63-.64-.63-1.09,0-.46.24-.87.63-1.1h0ZM136.68,46.45L75.84,11.32c-.5-.29-1.07-.44-1.64-.44-1.62,0-2.99,1.16-3.26,2.76l-8.75,52.6s0,.04,0,.06c-.39.06-.77.17-1.12.37l-42.82,24.73c-.71.41-1.14,1.15-1.14,1.97,0,0,0,0,0,0v4.43c0,.13.05.24.13.33.17.53.52.98,1.02,1.26l62.86,36.3c1.16.67,2.46,1.01,3.76,1.01s2.6-.33,3.76-1.01l41.17-23.77c.61-.35.98-.99.98-1.69v-4.04h0c0-.65-.31-1.22-.83-1.58.64-.31,1.11-.91,1.24-1.65l8.38-50.39c.4-2.43-.76-4.89-2.89-6.12h0Z" />
						<path d="M126.57,98.39l-59.21-34.18,7.79-45.98,59.21,34.19-7.79,45.98ZM135.39,51.95s-.01-.03-.03-.05c-.04-.08-.1-.15-.18-.2l-60.16-34.73c-.07-.04-.14-.06-.22-.06-.02,0-.04,0-.06,0-.06,0-.11.01-.16.03-.01,0-.02,0-.03,0-.01,0-.02.02-.03.03-.04.02-.08.06-.12.09-.02.02-.04.04-.05.06,0,.01-.02.02-.02.03-.02.04-.03.08-.04.13,0,.01-.02.03-.02.04l-7.98,47.05s0,0,0,.01c0,.04,0,.08,0,.12,0,.03,0,.05,0,.08,0,.03.03.06.04.09.01.03.02.06.04.09.01.02.04.03.05.05.03.03.06.06.09.08,0,0,0,0,0,0l60.13,34.72h0s.02.01.02.01c0,0,.02,0,.03,0,.04.02.09.04.14.05.03,0,.06,0,.08,0h0c.08,0,.15-.02.22-.06.02,0,.03-.02.05-.03.07-.04.13-.1.17-.17,0,0,0,0,0,0,.03-.05.05-.1.06-.16l7.98-47.05s0,0,0,0c.02-.09,0-.18-.03-.26h0Z" />
						<path d="M57.54,96.88c.25-.15.58-.15.83,0l18.86,10.89-11.58,6.68c-.25.14-.58.14-.83,0l-18.86-10.89,11.58-6.68ZM45.31,104.35l19.01,10.98c.28.16.6.25.92.25s.64-.09.92-.25l11.73-6.77c.28-.17.46-.46.46-.79s-.17-.63-.46-.79l-19.01-10.98c-.56-.32-1.28-.32-1.85,0l-11.73,6.77c-.29.16-.46.46-.46.79s.17.63.46.79Z" />
						<path d="M51.25,84.11l2.8,1.62-2.77,1.6-2.8-1.62,2.77-1.6ZM55.04,81.92l4.72,2.73-2.77,1.6-4.73-2.73,2.77-1.6ZM58.83,79.73l5.1,2.95h0s1.51.88,1.51.88l-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.27-.15l-4.85-2.8,2.77-1.6ZM62.61,77.55l3.57,2.06s0,0,0,0l.77.44-2.77,1.6-4.34-2.51,2.77-1.6ZM108.47,107.22l-5.08-2.94,2.77-1.6,5.08,2.93-2.77,1.6ZM104.68,109.41l-6.62-3.82,2.77-1.6,1.28.74s0,0,0,0l5.33,3.08-2.77,1.6ZM100.89,111.59l-2.8-1.62,2.77-1.6,2.8,1.62-2.77,1.6ZM69.27,85.76l-2.77,1.6-1.5-.86c-.07-.08-.16-.13-.27-.15l-1.04-.6,2.77-1.6,2.8,1.62ZM94.24,103.38l2.77-1.6,1.28.74s0,0,0,0l1.51.87-2.77,1.6-2.8-1.62ZM83.69,98.46l1.64.95h0l1.16.67-2.77,1.6-2.8-1.62,2.77-1.6ZM79.88,96.26l1.64.95s0,0,0,0l1.16.67-2.77,1.6-2.8-1.62,2.77-1.6ZM76.06,94.06l1.64.95,1.16.67-2.77,1.6-2.8-1.62,2.77-1.6ZM72.24,91.85l1.64.95s0,0,0,0l1.16.67-2.77,1.6-2.8-1.62,2.77-1.6ZM94.48,100.32s0,0,0,0l1.51.88-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.28.74ZM90.66,98.11s0,0,0,0l1.51.87-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.28.74ZM86.84,95.91s0,0,0,0l1.51.88-2.77,1.6-1.5-.86c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.29.74ZM83.02,93.7s0,0,0,0l1.51.87-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.28.74ZM79.2,91.5s0,0,0,0l1.51.87-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.28.74ZM75.39,89.29h0s1.51.88,1.51.88l-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.26-.15l-1.04-.6,2.77-1.6,1.28.74ZM71.57,87.09s0,0,0,0l1.51.87-2.77,1.6-1.5-.87c-.07-.08-.16-.13-.27-.15l-1.04-.6,2.77-1.6,1.28.74ZM61.83,89.04l2.77-1.6,1.64.95,1.16.67-2.77,1.6-2.8-1.62ZM65.65,91.25l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM84.74,102.27l2.77-1.6,1.64.95,1.16.67-2.77,1.6-2.8-1.62ZM88.56,104.47l2.77-1.6,1.64.95s0,0,0,0l3.05,1.76-2.77,1.6-4.7-2.71ZM94.27,107.77l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM104.37,101.65h0s.77.45.77.45l-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM100.55,99.45s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM96.73,97.24h0s.77.45.77.45l-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM92.91,95.04s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM89.09,92.83l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM85.27,90.63s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM81.45,88.42s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM77.64,86.22s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM73.82,84.02s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM70,81.81s0,0,0,0l.77.44-2.77,1.6-2.8-1.62,2.77-1.6,2.03,1.17ZM63.59,86.85l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM52.3,87.91l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM56.12,90.12l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM59.94,92.32l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM63.76,94.53l2.77-1.6,18.07,10.44-2.77,1.6-18.08-10.44ZM82.85,105.55l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM86.67,107.75l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM90.49,109.96l2.77-1.6,2.8,1.62-2.77,1.6-2.8-1.62ZM97.1,113.78l-2.8-1.62,2.77-1.6,2.8,1.62-2.77,1.6ZM115.03,103.43l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM111.21,101.23l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM107.39,99.02l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM103.57,96.82l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM99.75,94.61l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM95.93,92.41l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM92.12,90.21l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM88.3,88l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM84.48,85.8l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM80.66,83.59l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM76.84,81.39l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM73.02,79.18l-2.77,1.6-2.8-1.62,2.77-1.6,2.8,1.62ZM66.4,75.36l2.8,1.62-2.77,1.6-2.8-1.62,2.77-1.6ZM46.97,85.8s.02.07.03.1c0,.02,0,.04.02.06,0,0,.01,0,.02.02.04.07.09.13.17h0s0,0,0,0l7.64,4.41s0,0,0,0l3.82,2.2,22.91,13.23s0,0,0,0l3.81,2.2s0,0,0,0l3.82,2.2h0l3.81,2.2s0,0,0,0l3.81,2.2h0c.07.04.14.05.21.06.01,0,.03,0,.04,0,.01,0,.02,0,.04,0,.08,0,.15-.02.22-.06h0l3.78-2.18s0,0,0,0h0s3.78-2.18,3.78-2.18c0,0,0,0,0,0h0s3.78-2.19,3.78-2.19c0,0,0,0,0,0h0s3.78-2.19,3.78-2.19c0,0,0,0,0,0h0s3.78-2.19,3.78-2.19c0,0,0,0,0,0h0c.07-.04.12-.1.17-.17,0,0,.01,0,.02-.02.01-.02.01-.04.02-.06.01-.03.03-.06.03-.1,0-.03,0-.06,0-.1s0-.06,0-.1c0-.03-.02-.07-.03-.1,0-.02-.01-.04-.02-.06,0,0-.02-.01-.02-.02-.02-.03-.04-.05-.07-.07-.03-.03-.05-.05-.08-.07,0,0-.01-.01-.02-.02l-49.63-28.66s-.04-.01-.06-.02c-.03-.01-.06-.03-.1-.03-.03,0-.06,0-.1,0s-.06,0-.1,0c-.04,0-.07.02-.1.03-.02,0-.04,0-.06.02l-18.94,10.93s-.01.01-.02.02c-.03.02-.05.04-.08.07-.02.02-.05.05-.07.08,0,0-.01.01-.02.02-.01.02-.01.04-.02.06-.01.03-.03.06-.03.1,0,.03,0,.06,0,.1s0,.06,0,.1h0Z" />
					</svg>

					<p class="cf-full__title">
						<?php echo esc_html( $formatted_page_size ); ?>
					</p>
					<p class="cf-full__text">
						<?php echo esc_html__( 'pagesize', 'carbonfooter' ); ?>
					</p>
				</div>
				<div class="cf-full__col emissions">
					<svg class="cf-full__icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156.76 154.49">
						<path d="M28.52,123.15s9.68.67,9.84-7.28c.12-7.05-8.5-6.21-8.5-6.21,0,0-4.64-7.05-9.91-4.02-6.19,3.65-2.24,10.91-2.24,10.91,0,0-5.75,6.36.79,10.24,7.3,4.35,10.01-3.65,10.01-3.65h0Z" />
						<path d="M84.08,65.82c-1.04-.49-2.89-.93-3.75,0-1.09,1.38-.53,5.02.46,6.29,1.59,2.08,3.16.18,3.97-1.5.81-1.67,1.25-3.88-.67-4.79h0Z" />
						<path d="M118.9,60.01c2.61-3.48,3.92-7.76,3.71-12.11-.22-4.34-1.95-8.48-4.9-11.67-10.44-12.34-25.49-5.13-25.49-5.13h0c-2.14-2.48-4.9-4.36-7.99-5.44-3.09-1.08-6.42-1.34-9.64-.73-3.39.47-6.6,1.8-9.33,3.87-2.73,2.07-4.87,4.8-6.24,7.94,0,0-8.9-8.73-20.71,3.53-11.81,12.25-2.22,22.76-2.22,22.76,0,0-14.54,6.15-9.06,21.38,1.5,4.29,4.3,8.01,8.01,10.65,3.71,2.64,8.14,4.06,12.69,4.07,0,0-.69,20.34,15.23,22.92,4.33.85,8.81.28,12.79-1.63,3.98-1.91,7.23-5.05,9.28-8.95,0,0,7.05,15.87,23.6,6.29,16.55-9.57,10.44-18.56,10.44-18.56,0,0,16.76-1.89,18.14-17.29,1.37-15.41-18.3-21.89-18.3-21.89h0ZM73.67,83.8c-5.08,1.62-11.76.62-14.24-4.65h0c-1.09-2.64-1.15-5.6-.17-8.28.98-2.68,2.93-4.91,5.46-6.23,2.73-1.45,5.15,2.68,2.42,4.13s-5.01,5.48-3.19,8.62c1.82,3.14,5.78,2.66,8.5,1.76,2.71-.9,4.18,3.72,1.23,4.65h0ZM88.37,74.32c-2.75,4.09-7.93,5.13-11.32,1.09h0c-1.41-1.87-2.2-4.14-2.24-6.49-.04-2.35.65-4.65,2-6.57,2.61-2.91,7.63-2.33,10.58-.32,4.21,2.8,3.45,8.59.99,12.29h0ZM102.17,82.36h-6.31,0c-.89,0-1.7-.49-2.14-1.25-.44-.77-.44-1.71,0-2.48.74-1.2,1.76-2.17,2.54-3.3l.11-.19c-.85.14-1.71-.13-2.32-.74-.61-.6-.89-1.46-.76-2.31.62-3.53,5.69-4.09,7.7-1.45,1.06,1.56,1.27,3.54.56,5.29-.2.52-.45,1.01-.76,1.46h1.39c.89,0,1.71.47,2.15,1.24.44.77.44,1.72,0,2.49-.44.77-1.26,1.24-2.15,1.24h0Z" />
					</svg>
					<p class="cf-full__title">
						<?php
						/* translators: %s: Emissions value in grams of CO2 */
						echo wp_kses_post( sprintf( __( '%s gram CO<sub>2</sub>', 'carbonfooter' ), number_format( $emissions_value, 2 ) ) );
						?>
					</p>
					<p class="cf-full__text">
						<?php echo esc_html__( 'per visit', 'carbonfooter' ); ?>
					</p>
				</div>
				<div class="cf-full__col driving-distance">
					<svg class="cf-full__icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 215.7 154.49">
						<path d="M76.83,87.93c-.39,0-.71-.33-.71-.72,0-.15.05-.28.12-.4.66-.96,1.26-1.91,1.87-2.87,2-3.16,4.03-6.37,7.73-9.47.13-.11.29-.17.46-.17h8.54c.38,0,.69.29.71.67l1.07,12.35c.03.39-.26.74-.65.78-.05,0-.08,0-.13,0l-19.01-.16ZM99.26,75.01c0-.4.32-.72.72-.72h19.09c.38,0,.71.31.72.69l1.3,12.51c.04.39-.25.74-.64.78-.04,0-.08,0-.12,0l-19.22-.16c-.39.03-.73-.26-.77-.65l-1.08-12.39s0-.05,0-.08h0ZM102.52,93.56c0-.4.32-.72.72-.72h4.64c.4,0,.72.32.72.72s-.32.72-.72.72h-4.64c-.4,0-.72-.32-.72-.72M183.48,95.34c0-.4.32-.72.72-.72h9.06c1.23.84,1.78,1.73,1.78,2.83v4.15l-8.98-2.02c-.2-.04-.36-.16-.48-.35l-1.98-3.5c-.08-.12-.12-.25-.12-.4h0ZM190.08,106.89c0-.4.32-.72.72-.72h4.24v4.7c0,.44-.08.84-.22,1.22h-4.02c-.4,0-.72-.32-.72-.72v-4.48h0ZM128.37,70.05c-5.92-.24-11.71-.37-17.38-.4v-2.35h17.38v2.75ZM91.34,67.31h17.38v2.34c-5.9,0-11.68.14-17.38.39v-2.72ZM123.49,75.01c0-.4.32-.72.72-.72h12.29c.16,0,.31.05.43.14,3.52,2.28,6.53,4.49,9,6.65,2.51,2.18,4.48,4.3,5.88,6.35.22.33.14.77-.19.99-.14.09-.29.13-.45.12l-25.64-.22c-.37.01-.7-.26-.74-.64l-1.3-12.55s-.01-.08-.01-.12h0ZM132.9,94.9h-4.94c-.4,0-.72-.32-.72-.72s.32-.72.72-.72h4.94c.4,0,.72.32.72.72s-.32.72-.72.72M109.92,109.34c0-.4.32-.72.72-.72h42.53c.4,0,.72.32.72.72s-.32.72-.72.72h-42.53c-.4,0-.72-.32-.72-.72M67.18,101.66v-9.73h4.91c.38,0,.69.29.71.67l.18,3.2c.01.2-.07.41-.22.56l-5.58,5.3h0ZM67.18,110.53v-5h3.25c.4,0,.72.32.72.72v4.49c0,.4-.32.72-.72.72h-3.11c-.08-.29-.14-.6-.14-.92h0ZM67.07,86.19c-.86.96-1.3,2.09-1.3,3.37v20.97c0,2.8,2.33,5.09,5.2,5.09l6.71.02c.39,0,.71-.31.71-.7,0-.07-.02-.12-.04-.18.24-3.39,1.7-6.44,3.96-8.7,2.48-2.48,5.9-4.01,9.68-4.01s7.2,1.53,9.68,4.01c2.24,2.24,3.7,5.26,3.96,8.62-.06.1-.1.22-.1.35,0,.39.31.71.7.71l49.79.14c.39,0,.71-.31.71-.71,0-.13-.05-.25-.11-.35.29-3.06,1.59-6.05,3.94-8.4,2.67-2.67,6.18-4.01,9.68-4.01s7.01,1.34,9.68,4.01c2.37,2.37,3.68,5.39,3.94,8.49-.04.09-.07.19-.07.29,0,.39.31.71.7.71l6.71.06h.02c1.43,0,2.66-.5,3.68-1.48,1.02-.99,1.54-2.21,1.54-3.62v-13.43c0-2.66-2.19-4.04-4.09-4.96-10.74-5.13-29.08-5.99-31.37-6.08l-21.8-15.05c-.84-.57-1.75-.86-2.96-.93-1.88-.11-3.74-.2-5.58-.28v-2.85h4.74c.28,0,.55-.11.76-.29l2.44-2.22c.46-.43.5-1.14.07-1.6-.43-.46-1.14-.5-1.6-.07l-2.12,1.93h-50.18l-2.21-1.94c-.47-.41-1.19-.36-1.6.11-.41.47-.36,1.19.11,1.6l2.53,2.22c.21.18.47.28.75.28h4.74v2.83c-1.83.09-3.67.19-5.49.3-1.65.11-2.91.67-3.87,1.72l-12.65,14.03h0ZM98.36,112.76c.44.94.66,1.96.66,2.98s-.22,2.04-.66,2.98l-2.98-2.98,2.98-2.98h0ZM94.07,113.66c-.24-.24-.5-.42-.8-.57l2.96-2.96c.25.2.5.41.73.64.24.23.44.48.64.73l-2.96,2.96c-.14-.3-.34-.57-.57-.8M91.99,114.23c.42,0,.8.17,1.07.44s.44.65.44,1.07-.17.8-.44,1.07c-.27.27-.65.44-1.07.44s-.8-.17-1.07-.44c-.27-.28-.44-.65-.44-1.07s.17-.8.44-1.07.65-.44,1.07-.44M89.01,109.37c.94-.44,1.96-.66,2.98-.66s2.04.22,2.98.66l-2.98,2.98-2.98-2.98h0ZM89.91,113.66c-.23.23-.42.5-.57.8l-2.96-2.96c.2-.26.4-.5.64-.73.24-.23.48-.44.73-.63l2.96,2.96c-.3.14-.57.34-.8.57h0ZM94.07,117.82c.23-.23.43-.5.57-.8l2.96,2.96c-.2.26-.4.5-.64.73-.24.23-.48.44-.73.63l-2.96-2.96c.3-.14.57-.34.8-.57h0ZM83.53,115.74c0-2.17.83-4.33,2.48-5.99,1.65-1.65,3.82-2.48,5.99-2.48s4.33.83,5.99,2.48c1.65,1.65,2.48,3.82,2.48,5.99s-.83,4.33-2.48,5.99c-1.65,1.65-3.82,2.48-5.98,2.48s-4.33-.83-5.99-2.48c-1.65-1.65-2.48-3.82-2.48-5.99h0ZM83.93,107.68c-2.06,2.06-3.34,4.92-3.34,8.06s1.27,6,3.34,8.06c2.06,2.06,4.92,3.34,8.06,3.34s6-1.27,8.06-3.34c2.06-2.06,3.34-4.92,3.34-8.06s-1.27-6-3.34-8.06c-2.06-2.06-4.92-3.34-8.06-3.34s-6,1.27-8.06,3.34M85.62,118.72c-.44-.94-.66-1.96-.66-2.98s.22-2.04.66-2.98l2.98,2.98-2.98,2.98h0ZM94.97,122.11c-.94.44-1.96.66-2.99.66s-2.04-.22-2.98-.66l2.98-2.98,2.98,2.98h0ZM89.91,117.82c.24.23.5.42.8.57l-2.96,2.96c-.25-.2-.5-.4-.73-.64-.24-.24-.44-.48-.64-.73l2.96-2.96c.14.3.34.57.57.8M168.16,114.02c-.23.23-.43.5-.57.8l-2.96-2.96c.2-.26.4-.5.64-.73.23-.23.48-.44.73-.64l2.96,2.96c-.3.14-.57.34-.8.57h0ZM167.26,109.73c.94-.44,1.96-.66,2.98-.66s2.04.22,2.98.66l-2.98,2.98-2.98-2.98h0ZM161.78,116.09c0-2.17.83-4.33,2.48-5.98,1.65-1.65,3.82-2.48,5.99-2.48s4.33.83,5.99,2.48c1.65,1.65,2.48,3.82,2.48,5.98s-.83,4.33-2.48,5.99c-1.65,1.65-3.82,2.48-5.98,2.48s-4.33-.83-5.99-2.48c-1.65-1.65-2.48-3.82-2.48-5.99h0ZM162.18,108.04c-2.23,2.23-3.34,5.15-3.34,8.06,0,2.92,1.11,5.83,3.34,8.07,2.23,2.23,5.15,3.34,8.06,3.34s5.84-1.11,8.06-3.34c2.23-2.23,3.34-5.15,3.34-8.07s-1.12-5.84-3.34-8.06c-2.23-2.23-5.15-3.34-8.06-3.34s-5.84,1.12-8.06,3.34M170.24,114.59c.42,0,.8.17,1.07.44.27.27.44.65.44,1.07s-.17.8-.44,1.07c-.28.28-.65.45-1.07.45s-.8-.17-1.07-.45c-.27-.27-.44-.65-.44-1.07s.17-.8.44-1.07c.27-.27.65-.44,1.07-.44M176.61,113.12c.44.94.66,1.96.66,2.98s-.22,2.04-.66,2.98l-2.98-2.98,2.98-2.98h0ZM172.32,114.02c-.24-.23-.5-.43-.8-.57l2.96-2.96c.25.19.5.4.73.64.24.24.44.48.64.73l-2.96,2.96c-.14-.3-.34-.57-.57-.8M168.16,118.18c.24.23.5.43.8.57l-2.96,2.96c-.26-.2-.5-.41-.73-.64-.24-.23-.44-.48-.64-.73l2.96-2.96c.14.3.34.57.57.8M163.87,119.07c-.44-.94-.66-1.96-.66-2.98s.22-2.04.66-2.98l2.98,2.98-2.98,2.98h0ZM57.57,81.39c.36-.36.86-.59,1.4-.59h4.23c.55,0,1.04.22,1.4.59.36.36.59.86.59,1.4v19.68c0,.55-.22,1.05-.59,1.4-.36.36-.86.59-1.4.59h-4.23c-.55,0-1.04-.22-1.4-.59-.36-.36-.59-.86-.59-1.4v-19.68c0-.55.22-1.04.59-1.4M173.23,122.47c-.94.44-1.96.66-2.98.66s-2.04-.22-2.98-.66l2.98-2.98,2.98,2.98h0ZM171.53,118.74l2.96,2.96c.26-.2.5-.41.73-.64.23-.23.44-.48.63-.73l-2.96-2.96c-.14.3-.34.57-.57.8-.23.23-.5.43-.8.57h0Z" />
						<path d="M45.6,91.59s-4.46.31-4.53-3.42c-.06-3.31,3.92-2.91,3.92-2.91,0,0,2.14-3.31,4.57-1.89,2.85,1.71,1.03,5.12,1.03,5.12,0,0,2.65,2.99-.37,4.81-3.36,2.04-4.62-1.71-4.62-1.71Z" />
						<path d="M16.19,48.31c-1.2-1.63-1.81-3.64-1.71-5.68.1-2.04.9-3.98,2.26-5.48,4.81-5.79,11.75-2.41,11.75-2.41.99-1.16,2.26-2.04,3.68-2.55,1.43-.51,2.96-.63,4.44-.34,1.56.22,3.04.85,4.3,1.82,1.26.97,2.25,2.25,2.88,3.73,0,0,4.1-4.09,9.55,1.65,5.44,5.75,1.02,10.68,1.02,10.68,0,0,6.7,2.89,4.18,10.03-.69,2.01-1.98,3.76-3.69,5s-3.75,1.9-5.85,1.91c0,0,.32,9.55-7.02,10.75-1.99.4-4.06.13-5.9-.76-1.83-.89-3.33-2.37-4.28-4.2,0,0-3.25,7.44-10.88,2.95-7.63-4.49-4.81-8.71-4.81-8.71,0,0-7.73-.89-8.36-8.11-.63-7.23,8.44-10.27,8.44-10.27Z" />
					</svg>
					<p class="cf-full__text">
						<?php
						// Calculate annual driving distance based on 10k visitors
						// 1g CO<sub>2</sub> = 5 meters = 0.005 km
						$annual_visitors  = 12000;
						$driving_distance = number_format( ( $emissions['emissions'] * 0.005 ) * $annual_visitors, 2 );

						echo wp_kses_post(
							sprintf(
								/* translators: %s: amount in km car drive per year based on carbon emissions */
								__( '= <strong>%s km.</strong></br>drive per year.', 'carbonfooter' ),
								esc_html( $driving_distance )
							)
						);
						?>
					</p>
				</div>
				<div class="cf-full__col trees-offset">
					<svg class="cf-full__icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 3237.3 3268.2">
						<path d="M2692.5,1035c73.9-95.3,110.9-212.7,104.7-331.8-6.2-119.1-55.3-232.3-138.6-319.9-295-338.2-720.7-140.6-720.7-140.6h0c-60.6-68-138.5-119.4-225.9-149-87.5-29.7-181.4-36.6-272.5-20.1-95.8,12.8-186.6,49.4-263.7,106.1-77.1,56.7-137.8,131.6-176.4,217.6,0,0-251.7-239.1-585.6,96.6-333.9,335.7-62.8,623.7-62.8,623.7,0,0-411.2,168.6-256.2,586,42.5,117.6,121.6,219.6,226.4,291.9,104.8,72.2,230.1,111.2,358.7,111.5,0,0-19.4,557.5,430.6,628,122.3,23.3,249.2,7.7,361.6-44.5,38.1-17.7,52.5-41.5,85.4-66.5l-45.4-303.4-104.2-137.6c-15.5-7.5-32.1-15.3-48.5-22.3-40.4-17.4-78.4-35.1-117.5-48.5-39.1-13.4-80-23-111.8-25.4q-31.8-2.3-10.5-2.4s42.8-5,86.3-4.3c43.5.7,87.2,9,129.2,27.1,2.2.9,4.3,1.9,6.5,2.9-74.5-73.9-132.1-133.8-172.9-179.7-18-9.8-38.2-20.8-58.7-31-42.9-21.3-86.4-42.3-132.1-63.1-45.7-20.7-94.9-39.9-134.4-50.5q-39.5-10.7-12.7-5.7s54.9,3.4,107.6,12.1c52.7,8.7,102.6,23.9,147.3,48.5,6.9,3.8,13.6,7.7,20.1,11.7-45.6-63.4-95.2-139.1-148.8-227.1,110.8,130.9,214.1,230.8,309.9,300-2.8-3.5-5.5-6.9-8.1-10.3-19.5-25.1-33.3-46.7-43.9-72.2-10.6-25.6-22.8-59.6-32.5-94.9-9.7-35.3-17-71.7-21.1-109.3-4.1-37.6-4.7-76.4-6.1-105.6q-1.4-29.2,1-9.9s8.9,38,20.2,73.9c11.3,36,23.2,70.3,36,103.2,12.8,32.8,27,64.1,42.7,94.3,15.7,30.1,23.9,45.7,35.5,66.8,11.6,21.1,28.7,48.2,51.1,81,12.3,18,26,37.7,37.9,55.9,142.3,91.4,218.7,104.7,229,39.9,21-47.2,13.3-169.1-23-365.7l-6.1-20.3c-1.3-2.4-2.6-4.7-3.9-7.1-25.1-45.3-51.6-86.6-80.1-123.8-28.5-37.2-59.3-70.1-82.9-91.3-23.6-21.2-40.4-33.9-57.9-46.3-17.5-12.4-35.7-24.5-54.8-36.2-11-6.8-22.1-13.8-38.1-23.3-4.2-.8-8.4-1.6-12.4-2.3-11.7-2.1-22-3.2-33-4.1-11-.9-22.8-1.3-35.4-1.4-12.5-.1-25.9.2-37.7.9-11.8.7-22.4,1.6-34,2.9-11.6,1.3-24.2,3-37.9,4.1-13.7,1.1-28.5,1.7-38.7,2.4-10.2.7-15.4,1.1-20.7,1.6-5.3.5-10.6,1.1-16,1.7-5.4.6-10.8,1.4-24.7,3.6-13.9,2.2-34.3,5.7-51,8.2-16.7,2.5-29.5,4.1-38.6,5.2-9.1,1.1-14.7,1.5-20.8,1.6-6.1.1-16.5.3-27.2.1-10.7-.2-21.8-.7-33.2-1.6-11.4-.9-23.1-2-31.9-1.6-1.1,0-2.1,0-2.9.1.2,0,11.9-.6,23.1-3.1,11.3-2.6,22.2-5.2,32.6-7.9,10.4-2.7,20.4-5.3,30.1-8.1,9.7-2.8,12.1-3.2,17.6-4.9s15.1-4.9,28.4-9.4c13.3-4.6,30.4-10.2,51.3-17.1,20.9-6.9,27.2-8.6,32.8-10.1,5.6-1.5,11.2-2.9,16.8-4.2,5.6-1.3,21.5-3.9,36.4-6.5,14.9-2.6,29-3,42.1-3.1,13.2,0,25.4.1,36.7.6,10.4.4,23.6,1.7,36.6,3.2-36.1-19.7-76.3-41.6-111.5-61.3-53-29.6-94.8-53.9-125.3-73.1h0c-30.5-19.2-50.1-33.2-63.9-44-13.8-10.8-29.5-24.2-43.9-38.5s-27.1-29.6-38.2-45.9-20.4-33.4-28.2-45.5q-7.8-12.1-2.3-4.2s11.8,15.1,26.1,27.8c14.3,12.7,29.1,24.5,44.5,35.3,15.4,10.9,31.5,20.9,48.8,30.3,17.3,9.4,29.6,17,53.2,28.5,12.4,6.1,28.3,13.5,47.4,22.2-.7-.9-1.5-1.7-2.2-2.6-23.8-28-43.8-61.2-58.4-99.4-14.6-38.2-25.7-79.7-35.1-111.5q-9.3-31.8-1.5-11.2s20.3,39.3,41.7,74.7c21.4,35.4,42.6,67.8,60.2,99.4,15.2,27.3,30.3,53.2,38.7,70.1,5.2,2.3,10.4,4.6,15.9,7,47.4,21,106.5,46.8,177.6,77.7,71.1,30.9,95,44.1,115.5,57.4,20.4,13.3,39.7,27.6,58.2,42.2,18.5,14.6,36.2,29.5,53.6,45.5,17.4,16,49.9,52.5,78.8,93.1.3.5.7,1,1,1.4l-27.2-90.4c-46.2-230.7-72.9-355.2-80.1-373.7-24.3-93-60.8-201.1-109.5-324.5,72.7,124.4,123.6,222.5,152.8,294.3l21.9,59.5c5.3-30.4,13.3-63.8,24.1-96.7,12-36.5,27.6-72.4,45.5-108.1,0-6.9,0-13.9-.6-21-.7-9.1-1.5-16.2-2.9-24.6-1.4-8.5-3.4-18.5-6.2-30s-4.5-24.9-6.5-39.8-3.8-25.7-6-38.5c-2.2-12.8-4.8-27.5-7.7-44.1-2.9-16.6-6.1-35-9.3-55.5-3.3-20.4-4.4-29.7-5.1-37.3-.7-7.6-1.3-13.7-1.6-18.2-.3-4.6-.5-7.6-.5-8.7,0-1.5,3.8-1.6,3.7-2.1.2.3.9,2.1,2.2,5.3s3.3,7.8,6,13.9c2.6,6,5.8,13.5,11.7,27.5,5.9,14,13.4,32.6,19.8,49.7,6.5,17,12,32.4,16.8,46.2,4.7,13.7,8.6,25.9,12.5,39.2,3.9,13.4,7.9,28,10.2,41.4,1.5,8.9,2.4,17.1,3.1,24.9,7.5-12.6,15.2-25.2,23.3-37.7,22.8-35.4,42.4-64.4,63-90.6,20.6-26.2,42.3-49,64.6-68.2,22.4-19.3,45.5-34.8,58.5-39.5,23.8-11.4,15-1.5,25.8-8.2-8.3,10.1-26.7,28.1-44.3,48.2-17.6,20.1-34.5,42.5-50.8,67.6-16.3,25-31.9,52.8-49.2,86.3-17.3,33.5-34.9,69.5-50.4,105.2-15.4,35.7-28.9,71-40.3,106.1-11.4,35-23.2,69-32.5,101.4-9.3,32.4-16.2,62.1-21.1,89.5-3.1,17.2-5.3,33.4-6.9,48.7l164.1,445.6c25.2,53.9,50.1,87.4,74.9,100.4,37.6-14.2,86.9-108.1,147.9-281.8,19.8-33.4,92.1-132.6,216.9-297.9l195.6-331.4c-63.3,158.7-137.4,338-222.2,537.7,3.4-1.8,6.7-3.5,9.9-5.1,23.2-11.8,42.9-16.9,54.1-20.2,11.2-3.2,20.2-5.8,30.9-8.3,10.7-2.5,23-5.2,37.2-7.8,14.1-2.5,30-5,42.1-6.8,12.1-1.8,20.5-2.8,30.7-3.6,10.2-.8,22.1-1.4,35.8-1.8,13.7-.4,29.2-.5,41.4-2.2q12.2-1.7,4.1-.4s-16.1,3.3-30.1,8.1c-14,4.8-26.3,9.1-36.9,12.7-10.6,3.6-19.4,6.8-26.4,9.4-7.1,2.6-23.2,8.4-37.5,13.7-14.3,5.3-26.8,9.9-37.5,14.1-10.7,4.1-19.5,7.9-26.8,11.2-7.3,3.3-21.3,9.3-40.5,17.8-19.1,8.4-44.7,17.7-76,29.5-40.8,95.7-84,195.8-129.6,300.6-31.7,84.8-61.2,199.1-88.7,342.8,23.3-35.8,46.9-70.2,70.9-103.1,30.1-41.3,61-80.2,92.6-117.1,31.6-36.9,56.1-59.9,81.1-79,24.9-19.2,50.9-34.9,77.6-47.3,26.7-12.4,54.1-21.1,68.7-22,27.9-4.6,15.7,2.8,28.9-1-11.8,8-35.9,20.8-58.9,35.3-22.9,14.4-44.7,31-65.6,49.8-20.9,18.8-40.7,40-63.2,69.8-22.5,29.8-48.9,69-74.9,110.1-26,41.1-51.6,84.2-76.9,129.2-25.3,45-50.2,92-80.2,150-15.7,30.4-31.9,64.3-47.6,100.3-22,142.1-27.6,218.6-16.6,229.6.4,4.1.9,8.2,1.3,12.5,90.4,110.8,285.1,259.8,606.7,79.5,468-262.3,295.1-508.7,295.1-508.7,0,0,474-51.7,512.8-473.9,38.9-422.2-517.3-600-517.3-600Z" />
						<path d="M1946.6,3267.2l-530.5-.3,3.2-12.5c42-162.1,163.9-371.8,160.7-442.8l-77.2-486.8-101.4-133.9c-14-6.7-30.2-14.3-45.9-21.1-9.4-4.1-18.8-8.2-27.9-12.1-30.5-13.3-59.2-25.9-88.9-36.1-39.7-13.6-79.5-22.7-109.3-24.9-8.8-.6-15.1-1.1-19.3-1.5-2.3-.2-3.8-.3-4.9-.4-10.2-1.1-10.4-9-10.4-10.6.1-3.4,2.5-9.4,10.5-9.8.7,0,1.8,0,3.2,0,2.4,0,6,0,10.6,0,5.5-.6,45.6-4.9,87-4.3,33.2.5,65.3,5.4,95.6,14.4-58.1-58.4-104.9-107.4-139.4-146.1-16.5-9-36.8-20-56.9-30-49-24.4-90.9-44.4-131.7-62.9-49.5-22.4-96.6-40.2-132.9-50-10.9-2.9-18.8-5.1-24-6.5-2.8-.8-4.7-1.3-6-1.7-.9-.3-1.5-.5-2-.7-5.8-2.3-7.5-7.7-6.5-11.8.2-.9,2.3-9,12.3-7.6.9.1,2.2.3,4,.6,3.1.5,7.7,1.4,13.4,2.4,6.2.4,58.4,4,108,12.2,49.4,8.1,93.9,21.7,132.6,40.4-38.7-55.8-80.3-120.2-124.2-192.2l16.2-11.7c89.8,106.1,175.7,192.7,256,258.3-5.8-10.1-10.7-20.1-15-30.4-7.2-17.2-21-52.7-32.9-96.1-10.2-37.2-17.5-74.6-21.4-110.9-3.2-28.9-4.2-58-5.2-83.7-.3-8-.6-15.5-.9-22.5-.4-8.1-.7-13.9-.8-17.8,0-2-.1-3.5-.1-4.5-.1-10.4,8.3-11.4,9.2-11.5,3.4-.3,9.6,1.3,10.9,9.2.1.7.3,1.6.4,2.9.3,2.2.7,5.4,1.2,9.5,1.1,4.7,9.6,39.8,19.9,72.7,11.7,37.2,23.4,70.8,35.8,102.6,12.5,32.1,26.7,63.5,42.2,93.3,16.5,31.6,24.4,46.5,35.4,66.6,11.3,20.6,28.3,47.6,50.6,80.2,2.4,3.5,4.8,7,7.3,10.6,9.9,14.5,20.2,29.4,29.5,43.7,122.1,78.1,172.7,83.4,193.6,74,10-4.5,16-13.8,18.3-28.4l.2-1.3.5-1.2c9.8-22,12.8-63.1,9.1-122.2-3.8-60.2-14.8-139.9-32.7-237.1l-5.6-18.8c-1.1-2-2.2-4.1-3.4-6.1-25.8-46.5-51.7-86.6-79.3-122.5-25.8-33.6-56.3-67.2-81.6-90-22.6-20.3-39.1-32.9-57-45.6-18.2-12.9-36.4-24.9-54.2-35.9-3.1-1.9-6.3-3.9-9.5-5.9-7.7-4.7-16.3-10.1-27-16.5-4.1-.8-7.5-1.4-10.6-1.9-10.3-1.8-20.2-3-32.1-4-10-.8-21.3-1.2-34.7-1.4-12.1-.1-25.3.2-37,.8-10.8.6-21.1,1.5-33.5,2.8-3.7.4-7.6.9-11.5,1.3-8.4,1-17.2,2.1-26.6,2.8-9,.7-18.5,1.2-26.8,1.7-4.4.2-8.5.5-12,.7-10.1.7-15.3,1.1-20.4,1.6-5.2.5-10.5,1.1-15.8,1.7-5,.6-10.3,1.3-24.3,3.5-3.6.6-7.5,1.2-11.8,1.9-12.6,2.1-26.9,4.4-39.3,6.2-18.8,2.8-31.6,4.4-38.9,5.2-9.3,1.1-15.2,1.5-21.7,1.7-4.3.1-15.6.3-27.6.1-10.9-.2-22.2-.7-33.8-1.6l-3.5-.3c-9.8-.8-19.8-1.6-27.2-1.3h-2.9c0,.1-1-19.8-1-19.8.5,0,11.2-.6,21.4-2.9,10.9-2.5,21.7-5.1,32.3-7.8,11.2-2.9,21-5.5,29.9-8,4.5-1.3,7.5-2.1,9.9-2.7,2.7-.7,4.7-1.3,7.5-2.1,5.9-1.8,15.9-5.1,28.1-9.3,12.8-4.4,28.5-9.6,51.5-17.1,20.2-6.7,26.9-8.5,33.4-10.2,5.6-1.5,11.4-2.9,17-4.3,5.8-1.4,11.4-2.6,17.1-3.8,5.7-1.2,21.1-3.9,36.8-6.6,16-2.7,31.1-3.2,43.8-3.2,10.5,0,19.4,0,27.5.3-24.2-13.2-48.3-26.4-70.7-39-53.9-30.1-94.9-54-125.2-73.1h0s-.5-.3-.5-.3c-26.8-16.8-47.9-31.4-64.7-44.6-11.5-9-28.6-23.2-44.8-39.2-14.6-14.4-27.8-30.4-39.4-47.4-6.9-10.1-13.1-20.5-18.5-29.6-3.5-5.9-6.8-11.4-9.8-16.1-2.2-3.4-3.7-5.8-4.7-7.4-.5-.8-.9-1.5-1.2-1.9-4-6.4-.6-12,2.6-14.2,3.9-2.6,10.1-2.5,13.9,2.7.2.3.5.7.9,1.2.6.9,1.5,2.2,2.7,3.9,1.4,1.8,12.2,15.1,24.8,26.3,13.7,12.2,28.4,23.9,43.7,34.6,15.2,10.7,30.8,20.4,47.8,29.7,4.8,2.6,9.3,5.1,13.6,7.5,11.5,6.4,22.4,12.5,39.2,20.7,3.2,1.6,6.6,3.2,10.4,5-15-22.2-27.5-46.4-37.3-72.2-12-31.5-21.5-64.6-29.9-93.7-1.9-6.5-3.6-12.7-5.4-18.5-2.6-8.8-4.4-15.1-5.6-19.4-.6-2.3-1.1-3.8-1.4-4.9-2.5-10,4.7-13,6.2-13.5.4-.1,8.8-2.8,12.8,6.4.3.7.7,1.7,1.3,3.1.9,2.3,2.2,5.8,3.9,10.2,2.4,4.7,21.4,41,41.1,73.6,7.4,12.3,14.9,24.2,22.1,35.8,13.7,22.1,26.7,43,38.4,63.9,4.5,8.1,9,16.1,13.4,23.8,9.6,17,18,31.8,23.9,43.5,4.1,1.8,8.3,3.7,12.6,5.6,48.9,21.6,108.7,47.8,177.5,77.7,69.5,30.2,94.7,43.8,116.9,58.2,18.7,12.2,38,26.2,58.9,42.7,19.9,15.8,37.6,30.8,54.2,46,11.4,10.5,28.8,29.2,47.6,52.1l-11.5-38.2v-.5c-57.2-285.3-74.9-359.7-79.7-372l-.2-.5v-.6c-24.2-92.2-61-200.9-109.3-323.3l17.9-8.7c72.6,124.3,124.2,223.7,153.4,295.6v.3c.1,0,9.8,26.4,9.8,26.4,4.9-21.7,10.8-43.1,17.4-63.2,11.1-33.8,25.9-69,45-107.3,0-6.8-.2-12.6-.6-17.9-.6-8.5-1.5-15.4-2.8-23.7-1.5-9-3.5-18.8-6.1-29.3-2.8-11.4-4.5-24.4-6.4-38.3l-.3-2.5c-1.9-14.2-3.6-24.7-5.9-38.1-2.3-13.6-4.9-28.4-7.7-44-2.5-14.3-5.9-33.5-9.4-55.6-3.2-20-4.4-29.6-5.2-37.9-.6-6.4-1.2-12.6-1.6-18.5-.5-6.4-.6-8.4-.6-9.6h0c0-1.6.5-4.5,2.9-7.1l-6.2-44.1,25.7,44.3c.5.8.7,1.5,1.6,3.5.3.8.7,1.8,1.2,2.9,1.2,2.9,3.1,7.2,5.9,13.8,2.2,5,4.6,10.8,8.7,20.5l3,7.1c6,14.3,13.5,33,19.9,50,6.3,16.6,12,32.2,16.9,46.4,4.6,13.2,8.4,25.4,12.6,39.7,3.6,12.2,7.5,26.2,9.9,39.6,2.9-4.7,5.8-9.2,8.6-13.6,19.7-30.5,41-62.6,63.6-91.4,20.8-26.5,43-49.9,66-69.6,23.3-20.1,46.7-35.8,61.1-41.1,12.4-5.9,18-7,22.9-6.5.4-.2.9-.5,1.5-.9l51.9-32.3-38.9,47.1c-4.3,5.2-10.8,12.1-18.4,20.1-8.1,8.5-17.2,18.1-26.2,28.3-17.2,19.6-34,42-49.9,66.4-15.1,23.3-30.2,49.6-48.7,85.4-20,38.6-36.3,72.8-50.1,104.6-15.4,35.7-28.9,71.1-39.9,105.2-3.3,10-6.6,20.1-9.8,29.8-8.2,24.8-16,48.3-22.6,71.3-8.8,30.4-15.8,60.2-20.9,88.5-2.7,15.3-4.9,30.7-6.5,45.7l163.2,443.1c22.6,48.3,44.8,79.5,66.2,93,11.6-6.5,30-25.2,55.8-74.5,24.3-46.3,52-113.4,82.2-199.4l.3-.9.5-.9c20.1-33.9,91.2-131.5,217.2-298.4l195.3-330.9,17.9,8.8c-60.2,151.2-131.5,323.8-211.8,513.3,15.8-6.8,29.3-10.6,38.1-13.2,1.2-.3,2.3-.7,3.4-1,11.9-3.5,20.9-6,31.5-8.4,9.7-2.3,22.8-5.2,37.7-7.9,16.1-2.9,33.5-5.5,42.4-6.9,12.5-1.8,21.1-2.8,31.4-3.6,10.8-.8,23-1.5,36.3-1.8,2.2,0,4.5-.1,6.7-.2,11.7-.3,23.8-.6,33.5-1.9,3.4-.5,5.8-.8,7.4-1,.8-.1,1.5-.2,1.9-.3,7.5-1,11.1,4.5,11.7,8.3.7,4.7-2,10.3-8.5,11.4-.3,0-.7.1-1.2.2-.9.2-2.3.4-4,.7-1.7.4-16.2,3.5-28.7,7.8-10,3.4-19,6.6-27.3,9.4l-9.6,3.3c-9.1,3.1-17.9,6.3-26.3,9.3-2.3.8-5.5,2-9.4,3.4-7.8,2.8-18.5,6.7-28.1,10.3l-8.1,3c-11.1,4.1-20.7,7.7-29.3,11-9.4,3.6-18,7.2-26.3,11-4.1,1.9-10.3,4.6-18.2,8-6.3,2.8-13.8,6-22.4,9.8-15.7,6.9-35.9,14.5-59.3,23.2-4.3,1.6-8.7,3.3-13.3,5-40.5,94.9-83.5,194.6-127.9,296.4-27.6,73.9-53.9,171.8-78.4,291.5,14.5-21.4,29-41.9,43.2-61.5,29.6-40.6,60.9-80.2,93-117.7,29.4-34.3,54.9-59.2,82.6-80.5,25.3-19.5,52.1-35.7,79.5-48.4,27.7-12.8,55.7-21.8,71.8-22.9,14.6-2.4,20.3-2,25,0,.5-.1,1.2-.3,2.3-.6l59.4-16.8-51.1,34.7c-6.2,4.2-15.4,9.6-26.1,15.7-10.2,5.9-21.8,12.7-33.1,19.7-22.1,13.9-43.7,30.3-64.2,48.8-22.3,20.1-41.4,41.2-61.9,68.4-21.4,28.4-47.1,66.2-74.4,109.5-25.8,40.9-51.6,84.2-76.6,128.7-23.3,41.6-47.3,86.3-80,149.7-16.1,31.1-31.8,64.3-46.8,98.5-10.5,67.6-17.2,120.8-20.1,158.1-3.8,49.8,0,60.1,1.1,61.8l2.3,2.3.4,3.5c5.5,54.8,17.8,125,36.6,208.8,117.8,415.8,113.1,520,108.9,528.2l-2.8,5.5ZM1442,3247l489.1.2c-.9-11.2-8.5-128.6-26.5-200.9-17.8-71.4-45.8-174.9-83.5-307.6v-.5c-18.9-83.2-31.2-153.4-36.9-208.6-4.6-7.5-7.7-23.9-4.4-70.1,2.8-38.4,9.8-93.8,20.8-164.8l.2-1.3.5-1.2c15.3-35,31.4-69,47.9-100.9,32.9-63.6,56.9-108.6,80.3-150.3,25.2-44.8,51.1-88.4,77.2-129.6,27.6-43.7,53.7-82,75.4-110.8,21.3-28.3,41.2-50.2,64.5-71.2,21.3-19.2,43.8-36.3,66.9-50.8,7.6-4.8,15.2-9.3,22.5-13.6-14.2,3.4-33.4,10.3-51.8,18.8-26,12.1-51.5,27.6-75.7,46.1-27,20.7-50.7,43.9-79.6,77.6-31.8,37.1-62.8,76.3-92.1,116.5-23.2,31.8-47,66.3-70.6,102.7l-27.8,42.7,9.6-50c27.5-143.7,57.5-259.6,89.2-344.4l.2-.5c45-103.3,88.6-204.4,129.6-300.5l1.7-3.9,4-1.5c6-2.3,11.8-4.4,17.3-6.5,23.1-8.6,43-16.1,58.2-22.8,8.5-3.8,16.1-7,22.4-9.8,7.8-3.4,14-6.1,17.9-7.9,8.6-3.9,17.6-7.7,27.4-11.4,8.7-3.3,18.3-6.9,29.5-11.1l8.1-3c9.7-3.6,20.4-7.5,28.2-10.3,3.8-1.4,7-2.5,9.3-3.4,5.9-2.2,12.1-4.4,18.5-6.6-.7,0-1.3.1-2,.2-9.8.8-18,1.7-30,3.5-8.8,1.3-26,3.9-41.8,6.8-14.4,2.6-26.6,5.3-36.7,7.7-10.1,2.4-18.8,4.8-30.4,8.1-1.1.3-2.2.6-3.4,1-11.5,3.3-28.8,8.2-48.9,18.5-3.2,1.6-6.4,3.3-9.8,5l-24.7,12.8,10.9-25.6c63.3-149.1,121.2-288,172.6-414.5l-128.5,217.6-.3.5c-123,162.8-195.6,262.4-215.8,296.1-30.4,86.4-58.3,154.1-83,201.1-26.1,49.7-49.1,77.7-70.5,85.8l-4.2,1.6-4-2.1c-27-14.2-52.9-48.6-79.3-105.1l-.3-.8-164.9-447.8.2-2.3c1.7-16.2,4-32.9,7-49.5,5.2-29,12.4-59.4,21.3-90.6,6.7-23.3,14.5-47,22.8-72,3.2-9.7,6.5-19.7,9.8-29.7,11.3-34.7,24.9-70.7,40.6-106.9,13.9-32.2,30.5-66.8,50.7-105.8,18.8-36.4,34.2-63.3,49.7-87.2,16.4-25.3,33.8-48.4,51.7-68.7,5.1-5.9,10.3-11.5,15.3-16.8-11.8,7.1-26.7,18.1-41.2,30.5-22,18.9-43.3,41.4-63.3,66.8-22.1,28.1-43.1,59.8-62.5,89.8-7.2,11.1-14.5,23-23.1,37.4l-15.9,26.7-2.6-31c-.7-8.6-1.7-16.4-3-24.1-2.2-13.2-6.2-27.8-9.9-40.3-4.1-13.9-7.9-25.9-12.3-38.8-4.8-14-10.5-29.5-16.7-45.9-6.1-16-13-33.5-18.8-47.2.5,3.5,1.1,7.5,1.9,12,3.5,22,6.8,41.1,9.3,55.3,2.8,15.7,5.3,30.5,7.7,44.1,2.3,13.6,4.1,24.4,6,38.8l.3,2.5c1.8,13.9,3.4,25.8,6,36.2,2.7,11,4.8,21.3,6.4,30.8,1.5,9,2.4,16.4,3,25.5.5,6.5.7,13.4.6,21.8v2.3s-1.1,2.1-1.1,2.1c-19.2,38.3-33.9,73.2-44.9,106.7-9.9,30-18.1,63-23.7,95.3l-6.4,36.6-34.7-94.2c-19.5-48-49.2-108.5-88.6-180.8,26.7,74.7,48.2,143.1,64.2,204.3,7.8,21,34,143.5,80.2,374.3l44.4,147.5-35-48.9c-.2-.3-.4-.6-.7-.9-.1-.2-.2-.4-.4-.5-27.5-38.6-59.8-75.3-77.4-91.5-16.1-14.8-33.5-29.6-53-45-20.4-16.2-39.2-29.8-57.4-41.6-21.3-13.9-45.8-27-114-56.7-68.9-29.9-128.7-56.1-177.6-77.8-5.5-2.4-10.7-4.8-15.9-7.1l-2.6-1.1.3.4-41.3-18.8c-19.7-9-35.3-16.2-47.6-22.3-17.3-8.5-29-14.9-40.2-21.2-4.3-2.4-8.7-4.9-13.4-7.4-17.6-9.6-33.9-19.7-49.7-30.9-4.4-3.1-8.9-6.4-13.2-9.6,7.5,9.4,15.5,18.4,24,26.9,15.6,15.4,32,29,43.1,37.7,16.2,12.7,36.7,26.8,62.6,43.2l.4.2c30.1,18.9,70.9,42.7,124.8,72.8,31.2,17.4,65.7,36.2,99,54.4l57.7,31.5-51.2-6c-14.9-1.7-26.9-2.8-35.8-3.2-10.3-.4-21.8-.6-36.2-.6-11.9,0-26,.4-40.5,2.9-14.8,2.5-30.6,5.3-36,6.4-5.5,1.1-10.9,2.4-16.5,3.7-5.5,1.3-11.1,2.7-16.6,4.2-5.1,1.4-11,2.9-32.3,9.9-22.8,7.5-38.5,12.7-51.2,17.1-12.4,4.3-22.6,7.6-28.7,9.5-3.2,1-5.4,1.6-8.3,2.3-2.3.6-5.2,1.4-9.6,2.6-2.9.8-6,1.7-9.1,2.5,7,0,12.8-.1,15.6-.2,5.8-.1,11.2-.6,19.9-1.6,7.2-.8,19.7-2.4,38.3-5.2,12.3-1.8,26.5-4.1,39-6.2,4.3-.7,8.3-1.4,11.8-1.9,14.4-2.3,19.9-3,25.1-3.6,5.5-.6,10.9-1.2,16.3-1.7,5.3-.5,10.6-.9,20.9-1.6,3.6-.2,7.7-.5,12.2-.7,8.2-.5,17.5-1,26.3-1.7,9-.7,17.6-1.7,25.8-2.7,4-.5,8-1,11.8-1.4,12.7-1.4,23.3-2.3,34.5-2.9,12.2-.7,25.8-1,38.4-.9,13.8.1,25.6.6,36.1,1.4,12.6,1,23.1,2.3,34,4.2,3.6.6,7.6,1.4,12.6,2.3l1.7.3,1.5.9c11.6,6.9,20.7,12.5,28.8,17.6,3.2,2,6.3,3.9,9.4,5.8,18.2,11.2,36.8,23.5,55.3,36.6,18.5,13.1,35.5,26.1,58.8,47,26.2,23.5,57.6,58.2,84.1,92.7,28.2,36.7,54.7,77.6,81,125,1.3,2.4,2.6,4.7,3.9,7.1l.5.9,6.6,21.8v.5c36.8,198.9,44.3,320.1,22.9,370.4-3.6,20.9-13.6,35.1-29.7,42.3-19.7,8.8-47.3,6.4-84.3-7.3-34.7-12.8-78.4-36.2-130.1-69.3l-1.8-1.2-1.2-1.8c-9.5-14.6-20.1-30.1-30.4-45.1-2.5-3.6-4.9-7.2-7.3-10.7-22.7-33.1-40.1-60.7-51.7-81.9-11.1-20.2-19.1-35.3-35.6-67-15.8-30.4-30.4-62.4-43.1-95.3-12-30.7-23.3-63.1-34.7-98.8.7,10.7,1.6,21.6,2.8,32.5,3.8,35.3,10.8,71.5,20.8,107.7,8.5,30.9,20.2,65.1,32.1,93.7,9.6,23.1,21.9,43.4,42.6,69.9,2.4,3.1,5,6.4,8,10.1l46.9,58.1-60.5-43.7c-72.5-52.3-149.8-122.8-230.9-210.3,29.3,45.4,57.4,86.6,83.8,123.4l29,40.3-42.3-25.9c-6.9-4.2-13.3-8-19.7-11.5-41.3-22.7-88.5-38.2-144.1-47.4-7.7-1.3-15.5-2.4-23.2-3.5,21.7,8.3,44.8,17.9,68.4,28.6,41.1,18.6,83.1,38.7,132.4,63.2,21.1,10.5,42.1,22,59.1,31.2l1.5.8,1.2,1.3c40.5,45.6,98.6,105.9,172.5,179.3l40,39.6-51.2-23.5c-2-.9-4.2-1.9-6.3-2.8-38.7-16.7-80.8-25.6-125.4-26.3-.7,0-1.3,0-2,0,13.6,3.6,27.5,7.8,41.4,12.6,30.4,10.4,59.6,23.2,90.4,36.7,9.1,4,18.4,8.1,27.8,12.1,16.9,7.2,34.1,15.4,48.8,22.5l2.2,1,107,141.3,78.5,492.7v.8c3.4,71.1-117.5,278.8-158,437.2ZM908.1,955.1c4.5,14.1,9.3,28.4,14.6,42.3,13.7,35.9,32.8,68.4,56.6,96.5.4.5.8,1,1.2,1.4l1,1.1,27.9,32.5-1-2c-5.8-11.6-15.1-28.2-25-45.8-4.4-7.7-8.9-15.7-13.4-23.9-11.4-20.5-24.3-41.2-37.9-63.1-7.2-11.6-14.7-23.7-22.2-36-.6-1-1.2-2-1.8-3Z" />
					</svg>

					<p class="cf-full__text">
						<?php

						// Calculate number of trees needed to offset annual emissions
						// 1 tree absorbs 5900g CO<sub>2</sub> per year
						$annual_visitors  = 10000;
						$annual_emissions = $emissions['emissions'] * $annual_visitors;
						$trees_needed     = number_format( $annual_emissions / 5900, 1 );
						echo wp_kses_post(
							sprintf(
								/* translators: %s: trees needed to offset emissions per year */
								__( 'and <strong>%s trees</strong></br>offset per year.', 'carbonfooter' ),
								esc_html( $trees_needed )
							)
						);
						?>
					</p>
				</div>
			</div>


			<div class="cf-full__cta">
				<?php
				/* translators: %s: url to carbonfooter.nl */
				printf(
					'<a class="cf-full__cta-link" href="%s" target="_blank" rel="noopener noreferrer">%s <span class="cf-full__cta-link-text"><strong>Carbonfooter.nl</strong>%s</span></a>',
					esc_url( $link ),
					esc_html__( 'Want to learn more?', 'carbonfooter' ),
					wp_kses_post( $icon )
				);

				?>
			</div>
		</div>
		<?php
		return ob_get_clean();
	}

	/**
	 * Get emissions for the current page.
	 *
	 * Attempts, in order:
	 * - Current queried object ID
	 * - Global post ID
	 * - `p` query param
	 * Falls back to site average when no page data is available.
	 *
	 * @return array{emissions:string,page_size:mixed} Emissions string and raw page size
	 */
	private function get_current_page_emissions() {
		// Get the current queried object ID
		$post_id = get_queried_object_id();

		// If we don't have a post ID yet, try to get it from the global post
		if ( ! $post_id ) {
			$post_id = get_the_ID();
		}

		// If we still don't have a post ID, try to get it from the URL
		if ( ! $post_id && isset( $_GET['p'] ) ) {
			$post_id = absint( $_GET['p'] );
		}

		// Optional debug info guarded by filter to avoid production logging
		if ( apply_filters( 'carbonfooter_enable_debug_logging', false ) ) {
			Logger::log( 'CarbonFooter Debug - Post ID: ' . $post_id );
			Logger::log( 'CarbonFooter Debug - Is Single: ' . ( \is_singular() ? 'yes' : 'no' ) );
			Logger::log( 'CarbonFooter Debug - Query Object: ' . wp_json_encode( get_queried_object() ) );
		}

		// If we have a valid post ID, try to get its emissions (cache-first)
		if ( $post_id ) {
			$payload = $this->emissions->get_post_payload( (int) $post_id );
			if ( is_array( $payload ) && isset( $payload['emissions'] ) ) {
				$page_size = $payload['page_size'] ?? null;
				return array(
					'emissions' => number_format( (float) $payload['emissions'], 2 ),
					'page_size' => $page_size,
				);
			}
		}

		// Otherwise return the site average
		$average           = $this->emissions->get_average_emissions();
		$average_formatted = number_format( $average, 2 );
		return array(
			'emissions' => $average_formatted,
			'page_size' => '0 KB', // Default page size when using average
		);
	}

	/**
	 * Get the CTA icon SVG with proper escaping.
	 *
	 * Returns an <img> tag with a data URI so it passes through wp_kses and CSP.
	 *
	 * @return string Safe <img> markup for the CTA icon
	 */
	private function get_cta_icon() {
		// Use a data URI to avoid CSP issues while keeping inline SVG
		$svg_content = '<svg class="cf-full__cta-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 995 768" width="20" height="20">
    <path d="M102.26,600.22s-31.43-47.8-67.16-27.24c-41.94,24.74-15.18,73.97-15.18,73.97,0,0-38.96,43.14,5.38,69.43,49.47,29.52,67.88-24.74,67.88-24.74h0s65.6,4.55,66.68-49.35c.84-47.8-57.6-42.07-57.6-42.07Z" />
    <path d="M841.11,279.51c20.9-26.96,31.38-60.17,29.63-93.85-1.75-33.68-15.63-65.7-39.22-90.49C748.06-.49,627.65,55.4,627.65,55.4h0c-17.13-19.23-39.17-33.76-63.9-42.15-24.74-8.39-51.31-10.35-77.08-5.68-27.11,3.63-52.79,13.96-74.6,30-21.8,16.03-38.98,37.23-49.89,61.56,0,0-71.19-67.65-165.66,27.33-94.46,94.98-17.76,176.42-17.76,176.42,0,0-116.31,47.7-72.46,165.76,12.02,33.28,34.39,62.13,64.04,82.56,29.64,20.44,65.1,31.46,101.48,31.54,0,0-5.5,157.7,121.81,177.65,34.61,6.59,70.49,2.17,102.29-12.6,31.81-14.78,57.84-39.11,74.22-69.39,0,0,56.39,122.99,188.77,48.79,132.38-74.2,83.46-143.9,83.46-143.9,0,0,134.07-14.62,145.07-134.06,10.99-119.43-146.32-169.72-146.34-169.73Z" />
  </svg>';

		return '<img class="cf-full__cta-icon" src="data:image/svg+xml;base64,' . base64_encode( $svg_content ) . '" alt="Carbonfooter icon" width="20" height="20">';
	}
}
